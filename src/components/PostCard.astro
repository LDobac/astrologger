---
import { slug as slugger } from "github-slugger";
import { type CollectionEntry } from "astro:content";
import SeriesLink from "./SeriesLink.astro";
import {FormattedDate} from "@utils/FormattedDate";
import {Image} from "astro:assets";
import TagList from "./TagList.astro";
import { convert } from "html-to-text";
import {marked} from "marked";
import {DESC_LEN} from "@utils/Constants";

interface Props {
    post: CollectionEntry<"posts">
}

const GenerateDescription = (post: CollectionEntry<"posts">): string => {
    const renderedContent = convert(marked(post.body));
    
    return renderedContent.slice(0, DESC_LEN);
}

const { post } = Astro.props;

const { 
    title, 
    description = GenerateDescription(post), 
    date, 
    series, 
    tags, 
    og
} = post.data;
---

<div class="flex flex-col pb-6 border-b-2 w-full">
    <a href={"/posts/" + slugger(title)}>
        {og ? 
            <Image 
                class="rounded-xl object-cover bg-black" 
                src={og.img} 
                alt={og.alt} />
        :
            <Image 
                class="rounded-xl object-cover bg-black" 
                src={`/posts/${slugger(title)}.png`} 
                width={1200} height={630} 
                alt={"Thumbnail of " + title} />
        }
    </a>

    <div class="mt-2 leading-none">
        <a href={"/posts/" + slugger(title)} class="block text-lg font-bold truncate leading-none mr-4">{title}</a>
        {!!series ?
        <SeriesLink series={series} />
        :
        <br>
        }
    </div>
    
    <p class="mt-2 h-16 text-sm line-clamp-3">
        {!!description && description}
    </p>

    {!!tags ?
        <div class="mt-2">
            <TagList tags={tags} />
        </div>
    :
        <div class="mt-3">&nbsp;</div>
    }

    <p class="text-sm text-gray-400 mt-2">{FormattedDate(date)}</p>
</div>
